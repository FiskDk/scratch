<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body {
           background-color: #121212;
        }
        .splash {
            color: white;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-size: xx-large;
            font-weight: bolder;
            margin: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
    <script>
      //Define the spp var
      global.spp = []
      global.spp.version = "1.0"
      global.spp.log = function(msg) {
  
  console.log('%c[Scratch++] %c' + msg, 'color:lime;border:1px solid black', 'color:white;border:1px solid black');

}
      global.spp.loadExtScript = function(url) {
      spp.log("Loading external script...")
        fetch(url)
  .then(response => response.text())
  .then(data => {
let s = document.createElement('script');
s.innerHTML = data
s.onload = function() {
    this.remove();
};
(document.head || document.documentElement).appendChild(s);
  });
      }
      global.spp.loadExtStyle = function(url) {
      spp.log("Loading external style...")
        fetch(url)
  .then(response => response.text())
  .then(data => {
let s = document.createElement('style');
s.innerHTML = data
s.onload = function() {
    this.remove();
};
(document.head || document.documentElement).appendChild(s);
  });
      }
        global.__toggleDevTools = function(){
                        const currentWebContents = require('electron').remote.getCurrentWebContents();
                currentWebContents.openDevTools();
}


        //Important functions i guess?
        const waitUntilElementExists = (selector, callback) => {
    const el = document.querySelector(selector);
    
    if (el){
        return callback(el);
    }
    
    setTimeout(() => waitUntilElementExists(selector, callback), 500);
    }
 
//Define Scratch++ functions



   //Inject Scratch++ code
waitUntilElementExists(".menu-bar_scratch-logo_7D20g", function main(){
    //Scratch has loaded, now inject the custom logo, and the custom darkmode theme
    const fs = require("fs")
    const os = require("os")
document.getElementsByClassName("menu-bar_scratch-logo_7D20g menu-bar_clickable_26k4z")[0].parentElement.innerHTML = '<a style="text-align: center; color:white" href="javascript:__toggleDevTools()">Scratch++</a>'
spp.log("Loading...")
spp.log("Enabling Discord RPC...")

//Discord RPC code

'use strict';

/* eslint-disable no-console */
const path = require('path');
const url = require('url');
const DiscordRPC = require('discord-rpc');

// Set this to your Client ID.
const clientId = '742480129585840200';

// Only needed if you want to use spectate, join, or ask to join
DiscordRPC.register(clientId);

const rpc = new DiscordRPC.Client({ transport: 'ipc' });
const startTimestamp = new Date();

async function setActivity() {
  if (!rpc) {
    return;
  }

  rpc.setActivity({
    details: `Working on a Scratch project`,
    state: 'on Scratch++ for Windows',
    startTimestamp,
    largeImageKey: 'scratch',
    largeImageText: 'Scratch++',
    instance: false,
  });
}

rpc.on('ready', () => {
  setActivity();

  // activity can only be set every 15 seconds
  setInterval(() => {
    setActivity();
  }, 15e3);
});

rpc.login({ clientId }).catch(console.error);

spp.log("Loading plugin loader...")
fs.readFile("C:/Users/" + os.userInfo().username + "/AppData/Local/Programs/Scratch Desktop/resources/plugins/loader.js", 'utf8', function (err,data) {
  if (err) {
    return console.log(err);
  }
  eval(data)
});
spp.log("PluginLoader finished all tasks")
})

</script>
<script>require("source-map-support/source-map-support.js").install()</script></head>
<body>
    <div id="app">
        <img class="center" src="scratch.png" width="256px" height="256px" style="margin: 0 auto;display: block;margin-top: 30px">
        <p class="splash">Scratch++ by f1sk</p>
              
    </div>
<script src="renderer.js"></script></body>
</html>
